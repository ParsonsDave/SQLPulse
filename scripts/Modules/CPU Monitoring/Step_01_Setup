USE [SQLPulse]
GO

-- Insert values into the Modules table

	INSERT INTO Pulse.Modules (ModuleName, ModuleVersion, ModuleDescription, IsEnabled)
	VALUES 
		('CPU', 1.2, 'Monitors CPU usage of SQL Server and other processes', 1)

-- Insert values into the ModuleActions table to cover what the module can do

	INSERT INTO Pulse.ModuleActions (ModuleID, ActionType, SchemaName, SprocName, IsEnabled, ExecutionOrder, ActionDescription)
	VALUES 
		((SELECT ID FROM Pulse.Modules WHERE ModuleName = 'CPU'), 'CollectData', 'Module_CPU_CollectData', 1, 1, 'Collects CPU Utilization data from the SQL Server instance')

	INSERT INTO Pulse.ModuleActions (ModuleID, ActionType, SchemaName, SprocName, IsEnabled, ExecutionOrder, ActionDescription)
	VALUES 
		((SELECT ID FROM Pulse.Modules WHERE ModuleName = 'CPU'), 'Rollup', 'Pulse', 'Module_CPU_MonthlyRollup', 1, 3, 'Performs the Monthly Rollup calculations for the CPU module')



-- Create the data table(s)

	CREATE TABLE [dbo].[CPU_Data](
		[ID] [int] IDENTITY(1,1) NOT NULL,
		[EventTime] [datetime] NULL,
		[SqlService] [int] NULL,
		[IdleProcess] [int] NULL,
		[NonSqlProcess] [int] NULL
	) ON [PRIMARY]
	GO

-- Create the monthly rollup table for CPU

USE [SQLPulse]
GO

/****** Object:  Table [Pulse].[CPU_MonthlyRollup]    Script Date: 2/24/2026 10:31:15 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [Pulse].[CPU_MonthlyRollup](
	[RollupMonth] [date] NOT NULL,
	[ServerName] [sysname] NOT NULL,
	[ExpectedPoints] [int] NOT NULL,
	[CollectedPoints] [int] NOT NULL,
	[AccuracyPercent] [decimal](5, 2) NOT NULL,
	[AvgTotalCPU] [decimal](5, 2) NULL,
	[PeakTotalCPU] [decimal](5, 2) NULL,
	[P90TotalCPU] [decimal](5, 2) NULL,
	[MedianSQLCPU] [decimal](5, 2) NULL,
	[MedianNonSQLCPU] [decimal](5, 2) NULL,
	[MedianTotalCPU] [decimal](5, 2) NULL,
	[LoadAboveMedianSQL] [decimal](5, 2) NULL,
	[LoadAboveMedianNonSQL] [decimal](5, 2) NULL,
	[LoadAboveMedianTotal] [decimal](5, 2) NULL,
	[P90SQLCPU] [decimal](5, 2) NULL,
	[P90NonSQLCPU] [decimal](5, 2) NULL,
	[PctInTop10Total] [decimal](5, 2) NULL,
	[SaturationHours] [int] NULL,
	[WorstHourStart] [datetime2](0) NULL,
	[SQLPercentOfTotal] [decimal](5, 2) NULL,
	[NonSQLPercentOfTotal] [decimal](5, 2) NULL,
	[GeneratedUTC] [datetime2](0) NOT NULL,
	[GeneratedLocal] [datetime2](0) NOT NULL,
	[ReportGenerationTimeMethod] [int] NOT NULL,
 CONSTRAINT [PK_CPU_MonthlyRollup] PRIMARY KEY CLUSTERED 
(
	[RollupMonth] ASC,
	[ServerName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO


